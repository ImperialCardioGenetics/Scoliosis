---
title: "Scoliosis & MACE"
author: "Valentina Quintero Santofimio, Dr Kathryn McGurk"
date: "04/11/2022"
output: html_document
---
#Identification of participants with scoliosis in the UK Biobank library
```{r}
library(data.table)
library(dplyr)

#Load phenotype file 
load("/rds/general/project/lms-ukbiobank-raw/live/phenotypes/47602_jw/refreshfeb21/Kathryn/ukb45358.rda")

#All cause scoliosis (Self reported, Data coding 6 in UKB)
#141	1535	scoliosis
select_ncicsr <- my_ukb_58 %>%
  select(contains("f20002"))
dim(select_ncicsr)
#502490    136

searchList <- c("\\<1535\\>")

select_ncicsr$found <- apply(select_ncicsr, 1, function(x) as.integer(any(grepl(paste(searchList, collapse="|"),x))))
table(select_ncicsr$found)

##Data coding 19 (ICD9, ICD10 codes from HES)
#2875	M965	M96.5 Postradiation scoliosis
#12772	Q763	Q76.3 Congenital scoliosis due to congenital bony malformation
#16246	M41(not selectable)	M41 Scoliosis
#16249	M410(not selectable)	M41.0 Infantile idiopathic scoliosis
#16254	M4100	M41.00 Infantile idiopathic scoliosis (Multiple sites in spine)
#16257	M4101	M41.01 Infantile idiopathic scoliosis (Occipito-atlanto-axial region)
#16261	M4102	M41.02 Infantile idiopathic scoliosis (Cervical region)
#16264	M4103	M41.03 Infantile idiopathic scoliosis (Cervicothoracic region)
#16270	M4104	M41.04 Infantile idiopathic scoliosis (Thoracic region)
#16273	M4105	M41.05 Infantile idiopathic scoliosis (Thoracolumbar region)
#16277	M4106	M41.06 Infantile idiopathic scoliosis (Lumbar region)
#16280	M4107	M41.07 Infantile idiopathic scoliosis (Lumbosacral region)
#16285	M4108	M41.08 Infantile idiopathic scoliosis (Sacral and sacrococcygeal region)
#16288	M4109	M41.09 Infantile idiopathic scoliosis (Site unspecified)
#16292	M411(not selectable)	M41.1 Juvenile idiopathic scoliosis
#16295	M4110	M41.10 Juvenile idiopathic scoliosis (Multiple sites in spine)
#16304	M4111	M41.11 Juvenile idiopathic scoliosis (Occipito-atlanto-axial region)
#16307	M4112	M41.12 Juvenile idiopathic scoliosis (Cervical region)
#16311	M4113	M41.13 Juvenile idiopathic scoliosis (Cervicothoracic region)
#16314	M4114	M41.14 Juvenile idiopathic scoliosis (Thoracic region)
#16319	M4115	M41.15 Juvenile idiopathic scoliosis (Thoracolumbar region)
#16322	M4116	M41.16 Juvenile idiopathic scoliosis (Lumbar region)
#16326	M4117	M41.17 Juvenile idiopathic scoliosis (Lumbosacral region)
#16329	M4118	M41.18 Juvenile idiopathic scoliosis (Sacral and sacrococcygeal region)
#16335	M4119	M41.19 Juvenile idiopathic scoliosis (Site unspecified)
#16338	M412(not selectable)	M41.2 Other idiopathic scoliosis
#16342	M4120	M41.20 Other idiopathic scoliosis (Multiple sites in spine)
#16345	M4121	M41.21 Other idiopathic scoliosis (Occipito-atlanto-axial region)
#16350	M4122	M41.22 Other idiopathic scoliosis (Cervical region)
#16353	M4123	M41.23 Other idiopathic scoliosis (Cervicothoracic region)
#16357	M4124	M41.24 Other idiopathic scoliosis (Thoracic region)
#16360	M4125	M41.25 Other idiopathic scoliosis (Thoracolumbar region)
#16367	M4126	M41.26 Other idiopathic scoliosis (Lumbar region)
#16370	M4127	M41.27 Other idiopathic scoliosis (Lumbosacral region)
#16374	M4128	M41.28 Other idiopathic scoliosis (Sacral and sacrococcygeal region)
#16377	M4129	M41.29 Other idiopathic scoliosis (Site unspecified)
#16382	M413(not selectable)	M41.3 Thoracogenic scoliosis
#16385	M4130	M41.30 Thoracogenic scoliosis (Multiple sites in spine)
#16389	M4131	M41.31 Thoracogenic scoliosis-Occipit-atl-axl
#16392	M4132	M41.32 Thoracogenic scoliosis-Cervical
#16398	M4133	M41.33 Thoracogenic scoliosis (Cervicothoracic region)
#16401	M4134	M41.34 Thoracogenic scoliosis (Thoracic region)
#16405	M4135	M41.35 Thoracogenic scoliosis (Thoracolumbar region)
#16408	M4136	M41.36 Thoracogenic scoliosis-Lumbar
#16413	M4137	M41.37 Thoracogenic scoliosis-Lumbosacral
#16416	M4138	M41.38 Thoracogenic scoliosis-Sacral/sacrococ
#16420	M4139	M41.39 Thoracogenic scoliosis-Site unspe
#16423	M414(not selectable)	M41.4 Neuromuscular scoliosis
#16431	M4140	M41.40 Neuromuscular scoliosis (Multiple sites in spine)
#16434	M4141	M41.41 Neuromuscular scoliosis (Occipito-atlanto-axial region)
#16438	M4142	M41.42 Neuromuscular scoliosis (Cervical region)
#16441	M4143	M41.43 Neuromuscular scoliosis (Cervicothoracic region)
#16446	M4144	M41.44 Neuromuscular scoliosis (Thoracic region)
#16449	M4145	M41.45 Neuromuscular scoliosis (Thoracolumbar region)
#16453	M4146	M41.46 Neuromuscular scoliosis (Lumbar region)
#16456	M4147	M41.47 Neuromuscular scoliosis (Lumbosacral region)
#16462	M4148	M41.48 Neuromuscular scoliosis (Sacral and sacrococcygeal region)
#16465	M4149	M41.49 Neuromuscular scoliosis (Site unspecified)
#16469	M415(not selectable)	M41.5 Other secondary scoliosis
#16472	M4150	M41.50 Other secondary scoliosis (Multiple sites in spine)
#16477	M4151	M41.51 Other secondary scoliosis (Occipito-atlanto-axial region)
#16480	M4152	M41.52 Other secondary scoliosis (Cervical region)
#16484	M4153	M41.53 Other secondary scoliosis (Cervicothoracic region)
#16487	M4154	M41.54 Other secondary scoliosis (Thoracic region)
#16494	M4155	M41.55 Other secondary scoliosis (Thoracolumbar region)
#16497	M4156	M41.56 Other secondary scoliosis (Lumbar region)
#16501	M4157	M41.57 Other secondary scoliosis (Lumbosacral region)
#16504	M4158	M41.58 Other secondary scoliosis (Sacral and sacrococcygeal region)
#16509	M4159	M41.59 Other secondary scoliosis (Site unspecified)
#16512	M418(not selectable)	M41.8 Other forms of scoliosis
#16516	M4180	M41.80 Other forms of scoliosis (Multiple sites in spine)
#16519	M4181	M41.81 Other forms of scoliosis (Occipito-atlanto-axial region)
#16525	M4182	M41.82 Other forms of scoliosis (Cervical region)
#16528	M4183	M41.83 Other forms of scoliosis (Cervicothoracic region)
#16532	M4184	M41.84 Other forms of scoliosis (Thoracic region)
#16535	M4185	M41.85 Other forms of scoliosis (Thoracolumbar region)
#16540	M4186	M41.86 Other forms of scoliosis (Lumbar region)
#16543	M4187	M41.87 Other forms of scoliosis (Lumbosacral region)
#16547	M4188	M41.88 Other forms of scoliosis (Sacral and sacrococcygeal region)
#16550	M4189	M41.89 Other forms of scoliosis (Site unspecified)
#16561	M419(not selectable)	M41.9 Scoliosis, unspecified
#16564	M4190	M41.90 Scoliosis, unspecified (Multiple sites in spine)
#16568	M4191	M41.91 Scoliosis, unspecified (Occipito-atlanto-axial region)
#16571	M4192	M41.92 Scoliosis, unspecified (Cervical region)
#16576	M4193	M41.93 Scoliosis, unspecified (Cervicothoracic region)
#16579	M4194	M41.94 Scoliosis, unspecified (Thoracic region)
#16583	M4195	M41.95 Scoliosis, unspecified (Thoracolumbar region)
#16586	M4196	M41.96 Scoliosis, unspecified (Lumbar region)
#16592	M4197	M41.97 Scoliosis, unspecified (Lumbosacral region)
#16595	M4198	M41.98 Scoliosis, unspecified (Sacral and sacrococcygeal region)
#16599	M4199	M41.99 Scoliosis, unspecified (Site unspecified)

#f40001 (cause of death main)
select_cofdm <- my_ukb_58 %>%
  select(contains ("f40001"))
dim(select_cofdm)

#f40002 (cause of death secondary)
select_cofds <- my_ukb_58 %>%
  select(contains ("f40002"))
dim(select_cofds)

#type of cancer (toc) 
select_toc <- my_ukb_58 %>%
  select(contains ("f40006"))
dim(select_toc)

#external causes (exc)
select_exc <- my_ukb_58 %>%
  select(contains ("f41201"))
dim(select_exc)

#diagnosis main (dim)
select_dim <- my_ukb_58 %>%
  select(contains ("f41202"))
dim(select_dim)

#diagnosis secondary 
select_dis <- my_ukb_58 %>%
  select(contains ("f41204"))
dim(select_dis)

icd10<- bind_cols(select_cofdm, select_cofds, select_toc, select_exc, select_dim, select_dis)
dim(icd10)

searchList <- c("\\<M965\\>","\\<Q763\\>","\\<M41\\>","\\<M410\\>","\\<M4100\\>","\\<M4101\\>","\\<M4102\\>","\\<M4103\\>","\\<M4104\\>","\\<M4105\\>","\\<M4106\\>","\\<M4107\\>","\\<M4108\\>","\\<M4109\\>","\\<M411\\>","\\<M4110\\>","\\<M4111\\>","\\<M4112\\>","\\<M4113\\>","\\<M4114\\>","\\<M4115\\>","\\<M4116\\>","\\<M4117\\>","\\<M4118\\>","\\<M4119\\>","\\<M412\\>","\\<M4120\\>","\\<M4121\\>","\\<M4122\\>","\\<M4123\\>","\\<M4124\\>","\\<M4124\\>","\\<M4125\\>","\\<M4126\\>","\\<M4127\\>","\\<M4128\\>","\\<M4129\\>","\\<M413\\>","\\<M4130\\>","\\<M4131\\>","\\<M4132\\>","\\<M4133\\>","\\<M4134\\>","\\<M4135\\>","\\<M4136\\>","\\<M4137\\>","\\<M4138\\>","\\<M4139\\>","\\<M414\\>","\\<M4140\\>","\\<M4141\\>","\\<M4142\\>","\\<M4143\\>","\\<M4144\\>","\\<M4145\\>","\\<M4146\\>","\\<M4147\\>","\\<M4148\\>","\\<M4149\\>","\\<M415\\>","\\<M4151\\>","\\<M4152\\>","\\<M4153\\>","\\<M4154\\>","\\<M4155\\>","\\<M4156\\>","\\<M4157\\>","\\<M4158\\>","\\<M4159\\>","\\<M418\\>","\\<M4180\\>","\\<M4181\\>","\\<M4182\\>","\\<M4183\\>","\\<M4184\\>","\\<M4185\\>","\\<M4186\\>","\\<M4187\\>","\\<M4188\\>","\\<M4189\\>","\\<M419\\>","\\<M4190\\>","\\<M4191\\>","\\<M4192\\>","\\<M4193\\>","\\<M4194\\>","\\<M4195\\>","\\<M4196\\>","\\<M4197\\>","\\<M4198\\>","\\<M4199\\>")

icd10$found <- apply(icd10, 1, function(x) as.integer(any(grepl(paste(searchList, collapse="|"),x))))
table(icd10$found)

#Data coding 87 (ICD9, ICD10 from HES)
#10520	7373	7373 Kyphoscoliosis and scoliosis
#12819	75420	75420 Congenital postural scoliosis

#type of cancer: (toc2) 40013
select_toc2 <- my_ukb_58 %>%
  select(contains ("f40013"))

# diagnosis main (dm2) ICD9 41203
select_dm2 <- my_ukb_58 %>%
  select(contains ("f41203"))

#Diagnoses secondary (ds2) ICD9 41205
select_ds2 <- my_ukb_58 %>%
  select(contains ("f41205"))
icd9<- bind_cols(select_toc2, select_dm2, select_ds2)


searchList <- c("\\<7373\\>", "\\<75420\\>")
icd9$found <- apply(icd9, 1, function(x) as.integer(any(grepl(paste(searchList, collapse="|"),x))))
table(icd9$found)
  
results <- data.frame(my_ukb_58$eid, select_ncicsr$found, icd10$found, icd9$found)
colnames(results) <- c("eid_47602", "SR", "ICD10", "ICD9")

scoliosis <- results[which(results$SR == 1 | results$ICD10 == 1 | results$ICD9 == 1),]
dim(scoliosis)

write.table(scoliosis, "scoliosis.txt", quote = F, row.names = F, sep="\t")
```

#Scoliosis subtypes
#Congenital vs acquired scoliosis 
```{r}

##Data coding 19 (ICD9 and IC10 codes from HES)
#12772	Q763	Q76.3 Congenital scoliosis due to congenital bony malformation

#f40001 (cause of death main)
select_cofdm <- my_ukb_58 %>%
  select(contains ("f40001"))
dim(select_cofdm)

#f40002 (cause of death secondary)
select_cofds <- my_ukb_58 %>%
  select(contains ("f40002"))
dim(select_cofds)

#type of cancer (toc) 
select_toc <- my_ukb_58 %>%
  select(contains ("f40006"))
dim(select_toc)

#external causes (exc)
select_exc <- my_ukb_58 %>%
  select(contains ("f41201"))
dim(select_exc)

#diagnosis main (dim)
select_dim <- my_ukb_58 %>%
  select(contains ("f41202"))
dim(select_dim)

#diagnosis secondary 
select_dis <- my_ukb_58 %>%
  select(contains ("f41204"))
dim(select_dis)

icd10<- bind_cols(select_cofdm, select_cofds, select_toc, select_exc, select_dim, select_dis)
dim(icd10)

searchList <- c("\\<Q763\\>")

icd10$found <- apply(icd10, 1, function(x) as.integer(any(grepl(paste(searchList, collapse="|"),x))))
table(icd10$found)

#Data coding 87 (ICD9 and ICD10 from HES)
#12819	75420	75420 Congenital postural scoliosis

#type of cancer: (toc2) 40013
select_toc2 <- my_ukb_58 %>%
  select(contains ("f40013"))

# diagnosis main (dm2) ICD9 41203
select_dm2 <- my_ukb_58 %>%
  select(contains ("f41203"))

#Diagnoses secondary (ds2) ICD9 41205
select_ds2 <- my_ukb_58 %>%
  select(contains ("f41205"))
icd9<- bind_cols(select_toc2, select_dm2, select_ds2)


searchList <- c("\\<75420\\>")
icd9$found <- apply(icd9, 1, function(x) as.integer(any(grepl(paste(searchList, collapse="|"),x))))
table(icd9$found)
  
results <- data.frame(my_ukb_58$eid, icd10$found, icd9$found)
colnames(results) <- c("eid_47602", "ICD10", "ICD9")

scoliosis <- results[which(results$ICD10 == 1 | results$ICD9 == 1),]
dim(scoliosis)

##Data coding 19 (ICD9 and ICD10 from HES)
#f40001 (cause of death main)
select_cofdm <- my_ukb_58 %>%
  select(contains ("f40001"))
dim(select_cofdm)

#f40002 (cause of death secondary)
select_cofds <- my_ukb_58 %>%
  select(contains ("f40002"))
dim(select_cofds)

#type of cancer (toc) 
select_toc <- my_ukb_58 %>%
  select(contains ("f40006"))
dim(select_toc)

#external causes (exc)
select_exc <- my_ukb_58 %>%
  select(contains ("f41201"))
dim(select_exc)

#diagnosis main (dim)
select_dim <- my_ukb_58 %>%
  select(contains ("f41202"))
dim(select_dim)

#diagnosis secondary 
select_dis <- my_ukb_58 %>%
  select(contains ("f41204"))
dim(select_dis)

icd10<- bind_cols(select_cofdm, select_cofds, select_toc, select_exc, select_dim, select_dis)
dim(icd10)

#Childhood scoliosis (Infantile + Juvenile)
#16254	M4100	M41.00 Infantile idiopathic scoliosis (Multiple sites in spine)
#16257	M4101	M41.01 Infantile idiopathic scoliosis (Occipito-atlanto-axial region)
#16261	M4102	M41.02 Infantile idiopathic scoliosis (Cervical region)
#16264	M4103	M41.03 Infantile idiopathic scoliosis (Cervicothoracic region)
#16270	M4104	M41.04 Infantile idiopathic scoliosis (Thoracic region)
#16273	M4105	M41.05 Infantile idiopathic scoliosis (Thoracolumbar region)
#16277	M4106	M41.06 Infantile idiopathic scoliosis (Lumbar region)
#16280	M4107	M41.07 Infantile idiopathic scoliosis (Lumbosacral region)
#16285	M4108	M41.08 Infantile idiopathic scoliosis (Sacral and sacrococcygeal region)
#16288	M4109	M41.09 Infantile idiopathic scoliosis (Site unspecified)
#16292	M411(not selectable)	M41.1 Juvenile idiopathic scoliosis
#16295	M4110	M41.10 Juvenile idiopathic scoliosis (Multiple sites in spine)
#16304	M4111	M41.11 Juvenile idiopathic scoliosis (Occipito-atlanto-axial region)
#16307	M4112	M41.12 Juvenile idiopathic scoliosis (Cervical region)
#16311	M4113	M41.13 Juvenile idiopathic scoliosis (Cervicothoracic region)
#16314	M4114	M41.14 Juvenile idiopathic scoliosis (Thoracic region)
#16319	M4115	M41.15 Juvenile idiopathic scoliosis (Thoracolumbar region)
#16322	M4116	M41.16 Juvenile idiopathic scoliosis (Lumbar region)
#16326	M4117	M41.17 Juvenile idiopathic scoliosis (Lumbosacral region)
#16329	M4118	M41.18 Juvenile idiopathic scoliosis (Sacral and sacrococcygeal region)
#16335	M4119	M41.19 Juvenile idiopathic scoliosis (Site unspecified)

searchList_childhoood <- c("\\<M4100\\>","\\<M4101\\>","\\<M4102\\>","\\<M4103\\>","\\<M4104\\>","\\<M4105\\>","\\<M4106\\>","\\<M4107\\>","\\<M4108\\>","\\<M4109\\>","\\<M411\\>","\\<M4110\\>","\\<M4111\\>","\\<M4112\\>","\\<M4113\\>","\\<M4114\\>","\\<M4115\\>","\\<M4116\\>","\\<M4117\\>","\\<M4118\\>","\\<M4119\\>")

icd10$childhood <- apply(icd10, 1, function(x) as.integer(any(grepl(paste(searchList_childhoood, collapse="|"),x))))

#Other Idiopathic Scoliosis 
#16338	M412(not selectable)	M41.2 Other idiopathic scoliosis
#16342	M4120	M41.20 Other idiopathic scoliosis (Multiple sites in spine)
#16345	M4121	M41.21 Other idiopathic scoliosis (Occipito-atlanto-axial region)
#16350	M4122	M41.22 Other idiopathic scoliosis (Cervical region)
#16353	M4123	M41.23 Other idiopathic scoliosis (Cervicothoracic region)
#16357	M4124	M41.24 Other idiopathic scoliosis (Thoracic region)
#16360	M4125	M41.25 Other idiopathic scoliosis (Thoracolumbar region)
#16367	M4126	M41.26 Other idiopathic scoliosis (Lumbar region)
#16370	M4127	M41.27 Other idiopathic scoliosis (Lumbosacral region)
#16374	M4128	M41.28 Other idiopathic scoliosis (Sacral and sacrococcygeal region)
#16377	M4129	M41.29 Other idiopathic scoliosis (Site unspecified)
searchList_otheridiopathic <- c("\\<M412\\>","\\<M4120\\>","\\<M4121\\>","\\<M4122\\>","\\<M4123\\>","\\<M4124\\>","\\<M4124\\>","\\<M4125\\>","\\<M4126\\>","\\<M4127\\>","\\<M4128\\>","\\<M4129\\>")

icd10$otheridiopathic <- apply(icd10, 1, function(x) as.integer(any(grepl(paste(searchList_otheridiopathic, collapse="|"),x))))

#THoracogenic Scoliosis
#16382	M413(not selectable)	M41.3 Thoracogenic scoliosis
#16385	M4130	M41.30 Thoracogenic scoliosis (Multiple sites in spine)
#16389	M4131	M41.31 Thoracogenic scoliosis-Occipit-atl-axl
#16392	M4132	M41.32 Thoracogenic scoliosis-Cervical
#16398	M4133	M41.33 Thoracogenic scoliosis (Cervicothoracic region)
#16401	M4134	M41.34 Thoracogenic scoliosis (Thoracic region)
#16405	M4135	M41.35 Thoracogenic scoliosis (Thoracolumbar region)
#16408	M4136	M41.36 Thoracogenic scoliosis-Lumbar
#16413	M4137	M41.37 Thoracogenic scoliosis-Lumbosacral
#16416	M4138	M41.38 Thoracogenic scoliosis-Sacral/sacrococ
#16420	M4139	M41.39 Thoracogenic scoliosis-Site unspe

searchList_Thoracogenic <- c("\\<M413\\>","\\<M4130\\>","\\<M4131\\>","\\<M4132\\>","\\<M4133\\>","\\<M4134\\>","\\<M4135\\>","\\<M4136\\>","\\<M4137\\>","\\<M4138\\>","\\<M4139\\>")

icd10$Thoracogenic <- apply(icd10, 1, function(x) as.integer(any(grepl(paste(searchList_Thoracogenic, collapse="|"),x))))

#Neuromuscular Scoliosis 
#16423	M414(not selectable)	M41.4 Neuromuscular scoliosis
#16431	M4140	M41.40 Neuromuscular scoliosis (Multiple sites in spine)
#16434	M4141	M41.41 Neuromuscular scoliosis (Occipito-atlanto-axial region)
#16438	M4142	M41.42 Neuromuscular scoliosis (Cervical region)
#16441	M4143	M41.43 Neuromuscular scoliosis (Cervicothoracic region)
#16446	M4144	M41.44 Neuromuscular scoliosis (Thoracic region)
#16449	M4145	M41.45 Neuromuscular scoliosis (Thoracolumbar region)
#16453	M4146	M41.46 Neuromuscular scoliosis (Lumbar region)
#16456	M4147	M41.47 Neuromuscular scoliosis (Lumbosacral region)
#16462	M4148	M41.48 Neuromuscular scoliosis (Sacral and sacrococcygeal region)
#16465	M4149	M41.49 Neuromuscular scoliosis (Site unspecified)

searchList_Neuromuscular <- c("\\<M414\\>","\\<M4140\\>","\\<M4141\\>","\\<M4142\\>","\\<M4143\\>","\\<M4144\\>","\\<M4145\\>","\\<M4146\\>","\\<M4147\\>","\\<M4148\\>","\\<M4149\\>")

icd10$Neuromuscular <- apply(icd10, 1, function(x) as.integer(any(grepl(paste(searchList_Neuromuscular, collapse="|"),x))))


#Secondary Scoliosis 
#16469	M415(not selectable)	M41.5 Other secondary scoliosis
#16472	M4150	M41.50 Other secondary scoliosis (Multiple sites in spine)
#16477	M4151	M41.51 Other secondary scoliosis (Occipito-atlanto-axial region)
#16480	M4152	M41.52 Other secondary scoliosis (Cervical region)
#16484	M4153	M41.53 Other secondary scoliosis (Cervicothoracic region)
#16487	M4154	M41.54 Other secondary scoliosis (Thoracic region)
#16494	M4155	M41.55 Other secondary scoliosis (Thoracolumbar region)
#16497	M4156	M41.56 Other secondary scoliosis (Lumbar region)
#16501	M4157	M41.57 Other secondary scoliosis (Lumbosacral region)
#16504	M4158	M41.58 Other secondary scoliosis (Sacral and sacrococcygeal region)
#16509	M4159	M41.59 Other secondary scoliosis (Site unspecified)

searchList_secondary <- c("\\<M415\\>","\\<M4151\\>","\\<M4152\\>","\\<M4153\\>","\\<M4154\\>","\\<M4155\\>","\\<M4156\\>","\\<M4157\\>","\\<M4158\\>","\\<M4159\\>")

icd10$Secondary <- apply(icd10, 1, function(x) as.integer(any(grepl(paste(searchList_secondary, collapse="|"),x))))

#Other forms of scoliosis 
#16512	M418(not selectable)	M41.8 Other forms of scoliosis
#16516	M4180	M41.80 Other forms of scoliosis (Multiple sites in spine)
#16519	M4181	M41.81 Other forms of scoliosis (Occipito-atlanto-axial region)
#16525	M4182	M41.82 Other forms of scoliosis (Cervical region)
#16528	M4183	M41.83 Other forms of scoliosis (Cervicothoracic region)
#16532	M4184	M41.84 Other forms of scoliosis (Thoracic region)
#16535	M4185	M41.85 Other forms of scoliosis (Thoracolumbar region)
#16540	M4186	M41.86 Other forms of scoliosis (Lumbar region)
#16543	M4187	M41.87 Other forms of scoliosis (Lumbosacral region)
#16547	M4188	M41.88 Other forms of scoliosis (Sacral and sacrococcygeal region)
#16550	M4189	M41.89 Other forms of scoliosis (Site unspecified)

searchList_otherforms <- c("\\<M418\\>","\\<M4180\\>","\\<M4181\\>","\\<M4182\\>","\\<M4183\\>","\\<M4184\\>","\\<M4185\\>","\\<M4186\\>","\\<M4187\\>","\\<M4188\\>","\\<M4189\\>")

icd10$Otherforms <- apply(icd10, 1, function(x) as.integer(any(grepl(paste(searchList_otherforms, collapse="|"),x))))

#Unspecified types of scoliosis 
#16561	M419(not selectable)	M41.9 Scoliosis, unspecified
#16564	M4190	M41.90 Scoliosis, unspecified (Multiple sites in spine)
#16568	M4191	M41.91 Scoliosis, unspecified (Occipito-atlanto-axial region)
#16571	M4192	M41.92 Scoliosis, unspecified (Cervical region)
#16576	M4193	M41.93 Scoliosis, unspecified (Cervicothoracic region)
#16579	M4194	M41.94 Scoliosis, unspecified (Thoracic region)
#16583	M4195	M41.95 Scoliosis, unspecified (Thoracolumbar region)
#16586	M4196	M41.96 Scoliosis, unspecified (Lumbar region)
#16592	M4197	M41.97 Scoliosis, unspecified (Lumbosacral region)
#16595	M4198	M41.98 Scoliosis, unspecified (Sacral and sacrococcygeal region)
#16599	M4199	M41.99 Scoliosis, unspecified (Site unspecified)


searchList_Unspecified <- c("\\<M419\\>","\\<M4190\\>","\\<M4191\\>","\\<M4192\\>","\\<M4193\\>","\\<M4194\\>","\\<M4195\\>","\\<M4196\\>","\\<M4197\\>","\\<M4198\\>","\\<M4199\\>")

icd10$Unspecified <- apply(icd10, 1, function(x) as.integer(any(grepl(paste(searchList_Unspecified, collapse="|"),x))))


results <- data.frame(my_ukb_58$eid,icd10$childhood,icd10$otheridiopathic,icd10$childhood,icd10$Thoracogenic,icd10$Neuromuscular,icd10$Secondary,icd10$Otherforms, icd10$Unspecified)
colnames(results) <- c("eid_47602", "ICD10")

scoliosis_subtypes <- results[which(results$ICD10 == 1 ),]
dim(scoliosis_subtypes)

```

# Addition of first report of Scoliosis (GP-derived)
```{r}
#Load meta file for association  of disease analysis (Next step)
library(dplyr)
library(tidyverse)
file <- read.table("/rds/general/project/lms-ukbiobank-raw/live/metadata/output/ukbbMetaData.txt", header=T)
meta <- file[which(file$hasWithdrawn == "FALSE"),]
#meta 502324

#Addition of Scoliosis from SR, ICD9 and IC10 codes to the meta file
scoliosis <- read.table("scoliosis.txt", header = T)
dim(scoliosis)
meta$hasScoliosis <- meta$eid_47602 %in% scoliosis$eid_47602

#Addition of first report of scoliosis date
library(plyr)
df <- read.table("df_val.txt", header = T)
df$newscol <- is.na(df$date_m41_first_reported_scoliosis_f131906_0_0)
table(df$newscol)

colnames(df)[1] <- "eid_40616"
meta  <- join(meta, df, type="left", by="eid_40616")
colnames(meta)

#Create "All Scoliosis" column composed of participants with SR, ICD9, IC10 and GP-derived 

meta$AllScoliosis <- ifelse(meta$newscol == "FALSE" | meta$hasScoliosis == "TRUE", "TRUE", "FALSE")

#Reporting of scoliosis prior or after UK Biobank recruitment 
#How many participants had scoliosis flagged before recruitment?
Scoliosispeople <- meta[which(meta$AllScoliosis==TRUE),]

Scoliosispeople$diagnosis_before_receruit <- ifelse(Scoliosispeople$dateofrecruit>Scoliosispeople$date_m41_first_reported_scoliosis_f131906_0_0, "Before_recruit", "After_recruit")

```

##Association of disease analysis
```{r}
#Using all reports of scoliosis

#Table 1 Association of disease analysis
group_by(meta, AllScoliosis) %>%
  dplyr::summarise(
    count = n(),
    mean_agerecruit = mean(agerecruit, na.rm = TRUE),
    sd_agerecruit = sd(agerecruit, na.rm = TRUE),
    mean_DBP = mean(autoDiasBP, na.rm = TRUE),
    sd_DBP = sd(autoDiasBP, na.rm = TRUE),
    mean_SBP = mean(autoSysBP, na.rm = TRUE),
    sd_SBP = sd(autoSysBP, na.rm = TRUE),
    mean_bmi = mean(bmi, na.rm = TRUE),
    sd_bmi = sd(bmi, na.rm = TRUE)
  )

table(meta$AllScoliosis, meta$isBritCauc)
table(meta$AllScoliosis,meta$hasCMR)
table(meta$AllScoliosis,meta$sexgenetic)
table(meta$AllScoliosis,meta$hasHypertension)
table(meta$AllScoliosis,meta$hasValveDisease)
table(meta$AllScoliosis,meta$hasHypercholesterol)
table(meta$AllScoliosis,meta$hasDiabetes)
table(meta$AllScoliosis,meta$hasanyCM)
```

##Statistical analysis- burden testing (Unadjusted)
```{r}
#All Scoliosis participants 
meta$isBritCauc[is.na(meta$isBritCauc)] <- 0
chisq.test(table(meta$AllScoliosis, meta$sexgenetic), correct=FALSE)
chisq.test(table(meta$AllScoliosis, meta$isBritCauc), correct=FALSE)
chisq.test(table(meta$AllScoliosis, meta$hasHypercholesterol), correct=FALSE)
chisq.test(table(meta$AllScoliosis, meta$hasCMR), correct=FALSE)
chisq.test(table(meta$AllScoliosis, meta$hasDiabetes), correct=FALSE)
chisq.test(table(meta$AllScoliosis, meta$onMeds), correct=FALSE)
fisher.test(table(meta$AllScoliosis, meta$hasValveDisease))
fisher.test(table(meta$AllScoliosis, meta$hasHeartFail))
fisher.test(table(meta$AllScoliosis, meta$hasanyCM))

 
t.test(meta$agerecruit~meta$AllScoliosis)
t.test(meta$autoSysBP~meta$AllScoliosis)
t.test(meta$autoDiasBP~meta$AllScoliosis)
t.test(meta$bmi~meta$AllScoliosis)
```

##Statistical analysis of variables adjusted for covariates (Genetic sex and Age)
```{r}
library(plyr)
library(data.table)

delete.na <- function(DF, n=0) {
  DF[rowSums(is.na(DF)) <= n,]
}

women <- meta[which(meta$sexgenetic =="0"),]
men <- meta[which(meta$sexgenetic =="1"),]
summary(women$bmi)
summary(men$bmi)

#Multiple linear regression with age and sex
lm(autoSysBP ~ agerecruit + sexgenetic, data = meta)
lm(formula = autoSysBP ~ agerecruit + sexgenetic, data = meta)

#SBP
short <- data.frame(meta$eid_47602, meta$autoSysBP, meta$agerecruit, meta$sexgenetic)
dim(short)
shortnona <- delete.na(short)
names(shortnona) #check correct names
shortnona$autoSysBPres <- residuals(lm(meta.autoSysBP ~ meta.agerecruit + meta.sexgenetic, data = shortnona))


forjoin<- data.frame(shortnona$meta.eid_47602, shortnona$autoSysBPres)
colnames(forjoin) <- c("eid_47602","autoSysBPres")
meta2 <- join(meta, forjoin, type="left", by="eid_47602")

#DBP
short <- data.frame(meta$eid_47602, meta$autoDiasBP, meta$agerecruit, meta$sexgenetic)
shortnona <- delete.na(short)
dim(short)

shortnona$autoDiasBPres <- residuals(lm(meta.autoDiasBP ~ meta.agerecruit + meta.sexgenetic, data = shortnona))
forjoin<- data.frame(shortnona$meta.eid_47602, shortnona$autoDiasBPres)
colnames(forjoin) <- c("eid_47602","autoDiasBPres")
meta3 <- join(meta2, forjoin, type="left", by="eid_47602")

#BMI 
short <- data.frame(meta$eid_47602, meta$bmi, meta$agerecruit, meta$sexgenetic)
shortnona <- delete.na(short)
dim(short)

shortnona$bmires <- residuals(lm(meta.bmi ~ meta.agerecruit + meta.sexgenetic, data = shortnona))
forjoin<- data.frame(shortnona$meta.eid_47602, shortnona$bmires)
colnames(forjoin) <- c("eid_47602","bmires")
meta4 <- join(meta3, forjoin, type="left", by="eid_47602")

#Hypercholesterol 
short <- data.frame(meta$eid_47602, meta$hasHypercholesterol, meta$agerecruit, meta$sexgenetic)
shortnona <- delete.na(short)
dim(short)

shortnona$hypercholes <- residuals(lm(meta.hasHypercholesterol ~ meta.agerecruit + meta.sexgenetic, data = shortnona))
forjoin<- data.frame(shortnona$meta.eid_47602, shortnona$hypercholes)
colnames(forjoin) <- c("eid_47602","hypercholeres")
meta5 <- join(meta4, forjoin, type="left", by="eid_47602")

#Hypertension 
short <- data.frame(meta$eid_47602, meta$hasHypertension, meta$agerecruit, meta$sexgenetic)
shortnona <- delete.na(short)
dim(short)

shortnona$hypertension <- residuals(lm(meta.hasHypertension ~ meta.agerecruit + meta.sexgenetic, data = shortnona))
forjoin<- data.frame(shortnona$meta.eid_47602, shortnona$hypertension)
colnames(forjoin) <- c("eid_47602","hypertensionres")
meta6 <- join(meta5, forjoin, type="left", by="eid_47602")

#CMR 
short <- data.frame(meta$eid_47602, meta$hasCMR, meta$agerecruit, meta$sexgenetic)
shortnona <- delete.na(short)
dim(short)

shortnona$CMR <- residuals(lm(meta.hasCMR ~ meta.agerecruit + meta.sexgenetic, data = shortnona))
forjoin<- data.frame(shortnona$meta.eid_47602, shortnona$CMR)
colnames(forjoin) <- c("eid_47602","CMRres")
meta7 <- join(meta6, forjoin, type="left", by="eid_47602")

#Heart failure 
short <- data.frame(meta$eid_47602, meta$hasHeartFail, meta$agerecruit, meta$sexgenetic)
shortnona <- delete.na(short)
dim(short)

shortnona$HF <- residuals(lm(meta.hasHeartFail ~ meta.agerecruit + meta.sexgenetic, data = shortnona))
forjoin<- data.frame(shortnona$meta.eid_47602, shortnona$HF)
colnames(forjoin) <- c("eid_47602","HFres")
meta8 <- join(meta7, forjoin, type="left", by="eid_47602")

#Any CM 
short <- data.frame(meta$eid_47602, meta$hasanyCM, meta$agerecruit, meta$sexgenetic)
shortnona <- delete.na(short)
dim(short)

shortnona$CM <- residuals(lm(meta.hasanyCM ~ meta.agerecruit + meta.sexgenetic, data = shortnona))
forjoin<- data.frame(shortnona$meta.eid_47602, shortnona$CM)
colnames(forjoin) <- c("eid_47602","CMres")
meta9 <- join(meta8, forjoin, type="left", by="eid_47602")

#Diabetes 
short <- data.frame(meta$eid_47602, meta$hasDiabetes, meta$agerecruit, meta$sexgenetic)
shortnona <- delete.na(short)
dim(short)

shortnona$diabetes <- residuals(lm(meta.hasDiabetes ~ meta.agerecruit + meta.sexgenetic, data = shortnona))
forjoin<- data.frame(shortnona$meta.eid_47602, shortnona$diabetes)
colnames(forjoin) <- c("eid_47602","diabetesres")
meta10 <- join(meta9, forjoin, type="left", by="eid_47602")

#Valve diease 
short <- data.frame(meta$eid_47602, meta$hasValveDisease, meta$agerecruit, meta$sexgenetic)
shortnona <- delete.na(short)
dim(short)

shortnona$valvedisease <- residuals(lm(meta.hasValveDisease ~ meta.agerecruit + meta.sexgenetic, data = shortnona))
forjoin<- data.frame(shortnona$meta.eid_47602, shortnona$valvedisease)
colnames(forjoin) <- c("eid_47602","valvediseaseres")
meta11 <- join(meta10, forjoin, type="left", by="eid_47602")

#Age at recruitment 
t.test(meta11$agerecruit~meta4$AllScoliosis)

#T-test SBP
t.test(meta11$autoSysBPres~meta12$AllScoliosis)

#T-test DBP
t.test(meta11$autoDiasBPres~meta12$AllScoliosis)

#T-test BMI
t.test(meta11$bmires~meta12$AllScoliosis)

#Hypercholesterol 
t.test(meta11$hypercholeres ~ meta12$AllScoliosis)

#Hypertension
t.test(meta11$hypertensionres ~ meta12$AllScoliosis)

#CMR
t.test(meta11$CMRres ~ meta12$AllScoliosis)

#Diabetes
t.test(meta11$diabetesres ~ meta12$AllScoliosis)

#HF
t.test(meta11$HFres ~ meta12$AllScoliosis)

#CMR 
t.test(meta11$CMRres ~ meta12$AllScoliosis)

#Valve disease
t.test(meta11$valvediseaseres ~ meta12$AllScoliosis)
```

#Survival analysis of participants with scoliosis 
```{r}
#Survival analysis death curve
#Create df with death data and variable of interest 
death <- data.frame(meta$eid_47602, meta$monthofbirth, meta$yearofbirth, meta$dateofdeath, meta$sexgenetic, meta$AllScoliosis, meta$MACE)

death$meta.monthofbirth <- as.character(death$meta.monthofbirth)
death$meta.monthofbirth[death$meta.monthofbirth == "January"] <- "01"
death$meta.monthofbirth[death$meta.monthofbirth == "February"] <- "02"
death$meta.monthofbirth[death$meta.monthofbirth == "March"] <- "03"
death$meta.monthofbirth[death$meta.monthofbirth == "April"] <- "04"
death$meta.monthofbirth[death$meta.monthofbirth == "May"] <- "05"
death$meta.monthofbirth[death$meta.monthofbirth == "June"] <- "06"
death$meta.monthofbirth[death$meta.monthofbirth == "July"] <- "07"
death$meta.monthofbirth[death$meta.monthofbirth == "August"] <- "08"
death$meta.monthofbirth[death$meta.monthofbirth == "September"] <- "09"
death$meta.monthofbirth[death$meta.monthofbirth == "October"] <- "10"
death$meta.monthofbirth[death$meta.monthofbirth == "November"] <- "11"
death$meta.monthofbirth[death$meta.monthofbirth == "December"] <- "12"

# Format of year XXXX- MonthXX- day XX 
death$dateofbirth <- paste0(death$meta.yearofbirth,"-", death$meta.monthofbirth, "-01")
death$dateofbirth <- as.Date(death$dateofbirth)
death$meta.dateofdeath <- as.Date(death$meta.dateofdeath)
death$timetodeath <- death$meta.dateofdeath - death$dateofbirth

death$isdead <- as.character(death$meta.dateofdeath)
#Censoring of participants- do we know when they died? 
#if so = 1 (Event occurs)
#Otherwise = 0 as we do not know when this could happen. 

death$isdead[is.na(death$isdead)] <- 0 #No event occurred (ALIVE)
death$isdead[death$isdead > 0] <- 1 #Event occurs (DEAD)

death$meta.sexgenetic <- gsub(0,"Female",as.character(death$meta.sexgenetic))
death$meta.sexgenetic <- gsub(1,"Male",as.character(death$meta.sexgenetic))
write.table(death, "scoliosisall_death_pub.txt", row.names= F, quote= F, sep="\t")

#Plotting the survival curve graph
#Figure 1
install.packages("survival")
install.packages("survminer")
install.packages("ggplot2")

library(survival)
library(survminer)
library(ggplot2)
death <-read.table("scoliosisall_death_pub.txt", header = T, sep="\t")

fit3 <- survfit(Surv(timetodeath, isdead) ~ Scoliosis + Sex, data=death)

ggsurvplot(fit3,
          pval = TRUE, conf.int = TRUE,
          risk.table = TRUE,
          risk.table.col = "strata", 
          linetype = "strata", 
           legend.title = "Status",
          xlim=c(40,85),#Plot from 40yrs (min recruitment)
          xlab="Time (Years)",
          surv.median.line = "hv", 
          ggtheme = theme_bw(),
          legend.labs=c("Females without scoliosis" ,"Males without scoliosis", "Females with scoliosis", "Males with scoliosis"))

```

##Cumulative hazard curve of Scoliosis patients and MACE in the UKB
```{r}
#Create df with death data and variables of interest
#To check what may be driving MACE, e.g Heart failure, arrythmia...
death <- data.frame(meta$eid_47602, meta$monthofbirth, meta$yearofbirth, meta$dateofdeath, meta$sexgenetic, meta$AllScoliosis, meta[45:52])

death$meta.monthofbirth <- as.character(death$meta.monthofbirth)
death$meta.monthofbirth[death$meta.monthofbirth == "January"] <- "01"
death$meta.monthofbirth[death$meta.monthofbirth == "February"] <- "02"
death$meta.monthofbirth[death$meta.monthofbirth == "March"] <- "03"
death$meta.monthofbirth[death$meta.monthofbirth == "April"] <- "04"
death$meta.monthofbirth[death$meta.monthofbirth == "May"] <- "05"
death$meta.monthofbirth[death$meta.monthofbirth == "June"] <- "06"
death$meta.monthofbirth[death$meta.monthofbirth == "July"] <- "07"
death$meta.monthofbirth[death$meta.monthofbirth == "August"] <- "08"
death$meta.monthofbirth[death$meta.monthofbirth == "September"] <- "09"
death$meta.monthofbirth[death$meta.monthofbirth == "October"] <- "10"
death$meta.monthofbirth[death$meta.monthofbirth == "November"] <- "11"
death$meta.monthofbirth[death$meta.monthofbirth == "December"] <- "12"

death$dateofbirth <- paste0(death$meta.yearofbirth,"-", death$meta.monthofbirth, "-01")

death$dateofbirth <- as.Date(death$dateofbirth)
death$meta.dateofdeath <- as.Date(death$meta.dateofdeath)

death2 <- death 
death2$timetoevent <- as.Date(death2$MACE) - death2$dateofbirth #Event is MACE or death 
hmm <- death2[which(death2$timetoevent<0),]
death3 <- death2[!death2$meta.eid_47602 %in% hmm$meta.eid_47602,]
death3$now <- as.Date("2021-01-01")
death3$dobnow <- death3$now - death3$dateofbirth
death3$dod <-death3$meta.dateofdeath - death3$dateofbirth
death3$timetouse <- pmin(death3$dobnow, death3$timetoevent, death3$dod, na.rm=TRUE)

#(censoring)
death3$event <- ifelse(is.na(death3$MACE) & is.na(death3$dod), 0,1) 
#0 Alive and No event
#1 Dead or event 
death3$timetouseFinal <- death3$timetouse/365 #Plot in years


#Plotting the cumulative incidence curve
install.packages("survival")
install.packages("survminer")
install.packages("ggplot2")
library(survival)
library(survminer)
library(ggplot2)

#Figure 3A
surv_object  <- Surv(time= as.integer(death3$timetouseFinal), death3$event) 
fit1 <- survfit(surv_object ~ Scoliosis, data = death3)

ggsurvplot(fit1,
ylim=c(0,1), xlim=c(40,85), #Plot from 40yrs (min recruitment)
xlab = "Years",
ylab="Probability freedom from events",
legend='bottom',
legend.title = 'Status', font.legend=c(10),
risk.table = TRUE, risk.table.title = NULL, risk.table.height=0.30,
legend.labs=c("Participants without scoliosis", "Participants with scoliosis"),
linetype='strata',
fontsize=4, font.x=12, font.y=12, font.tickslab=12,
break.time.by = 10,
break.y.by=0.1,
fun='cumhaz',
title=NULL) 

#Cox model Hazard ratio 
res.cox <- coxph(Surv(timetouseFinal, as.logical(event)) ~ Scoliosis, data=death3)
print(res.cox)
summary(res.cox)
summary(res.cox)$coefficients[, 5]

#Cumulative incidence curve stratified by genetic sex
#Figure 3B
fit2 <- survfit(surv_object ~ Scoliosis + Sex, data = death3)

ggsurvplot(fit1,
ylim=c(0,1), xlim=c(40,85),#Plot from 40yrs (min recruitment)
xlab = "Years",
ylab="Probability freedom from events",
legend='bottom',
legend.title = 'Status', font.legend=c(10),
risk.table = TRUE, risk.table.title = NULL, risk.table.height=0.30,
legend.labs=c("Females without scoliosis" ,"Males without scoliosis", "Females with scoliosis", "Males with scoliosis"),
linetype='strata',
fontsize=4, font.x=12, font.y=12, font.tickslab=12,
break.time.by = 10,
break.y.by=0.1,
fun='cumhaz',
title=NULL) 

#Cox model Hazard ratio 
res.cox <- coxph(Surv(timetouseFinal, as.logical(event)) ~ Scoliosis + Sex, data=death3)
print(res.cox)
summary(res.cox)
summary(res.cox)$coefficients[, 5]
            
```

##Sorting of CMR traits
```{r}
#Are the CMRI traits altered in participants with scoliosis in the UKB? 

#Load CMR data available in the UK Biobank
most <- read.csv("/rds/general/project/lms-ukbiobank-raw/live/derivedPhenotypes/CMRphenotypes_39k/clinical_measures_39k_collated_PDSR.csv", header=T)

wtmax <- read.csv("/rds/general/project/lms-ukbiobank-raw/live/derivedPhenotypes/CMRphenotypes_39k/39k_Max_WT.csv", header=T)

trabec <- fread("/rds/general/project/lms-ukbiobank-raw/live/derivedPhenotypes/CMRphenotypes_27k/input-data/fractal_dimension_26k_18545.csv", header=T)
trabec <-data.frame(trabec)

covar <- read.table("/rds/general/project/lms-ukbiobank-raw/live/derivedPhenotypes/CMRphenotypes_39k/Phenotypes.txt", header=T)

sapply(most, function(x) sum(is.na(x)))
library(MASS)
delete.na <- function(DF, n=0) {
  DF[rowSums(is.na(DF)) <= n,]
}
covar2<- delete.na(covar)
most2 <- join(most, covar2, type="left", "eid_18545")

#Grouping of traits 
short395 <- data.frame(most2$LVESV..mL.,most2$LVSV..mL., most2$LVCO..L.min., most2$LVM..g., most2$LVEF...., most2$LVEDV..mL., most2$RVEDV..mL., most2$RVESV..mL., most2$RVSV..mL., most2$RVEF...., most2$Age, most2$Sex, most2$Race, most2$BSA, most2$SBP, most2$eid_18545)
short2_395 <- delete.na(short395)

#Logistic regression analysis to adjust CMR traits for age, genetic sex, White ancestry, BSA and SBP
short2_395$LVEDVres <- stdres(lm(most2$ LVEDV..mL. ~ most2$Age + most2$Sex+ most2$Race+ most2$BSA+ most2$SBP, data=short2_395 ))

short2_395$LVEFres <- stdres(lm(most2$LVEF....  ~ most2$Age + most2$Sex+ most2$Race+ most2$BSA+ most2$SBP, data=short2_395 ))

short2_395$LVESVres <- stdres(lm(most2$LVESV..mL. ~ most2$Age + most2$Sex+ most2$Race+ most2$BSA+ most2$SBP, data=short2_395 ))

short2_395$LVSVres <- stdres(lm(most2$LVSV..mL. ~ most2$Age + most2$Sex+ most2$Race+ most2$BSA+ most2$SBP, data=short2_395 ))

short2_395$LVCOres <- stdres(lm(most2$LVCO..L.min. ~  most2$Age + most2$Sex+ most2$Race+ most2$BSA+ most2$SBP, data=short2_395 ))

short2_395$LVMres <- stdres(lm(most2$LVM..g. ~  most2$Age + most2$Sex+ most2$Race+ most2$BSA+ most2$SBP, data=short2_395 ))

short2_395$RVEDVres <- stdres(lm(most2$RVEDV..mL. ~  most2$Age + most2$Sex+ most2$Race+ most2$BSA+ most2$SBP, data=short2_395 ))

short2_395$RVESVres <- stdres(lm(most2$RVESV..mL. ~  most2$Age + most2$Sex+ most2$Race+ most2$BSA+ most2$SBP, data=short2_395 ))


short2_395$RVSVres <- stdres(lm(most2$RVSV..mL. ~  most2$Age + most2$Sex+ most2$Race+ most2$BSA+ most2$SBP, data=short2_395 ))

short2_395$RVEFres <- stdres(lm(most2$RVEF.... ~  most2$Age + most2$Sex+ most2$Race+ most2$BSA+ most2$SBP, data=short2_395 ))

#Grouping of traits 818 
short818 <- data.frame(most2$LAV.max..mL., most2$LAV.min..mL., most2$LASV..mL., most2$LAEF...., most2$RAV.max..mL., most2$RAV.min..mL.,  most2$RASV..mL., most2$RAEF...., most2$Age, most2$Sex, most2$Race, most2$BSA, most2$SBP, most2$eid_18545)
short2_818 <- delete.na(short818)

#Logistic regression analysis to adjust CMR traits for age, genetic sex, White ancestry, BSA and SBP
short2_818$LAVmaxres <- stdres(lm(most2$LAV.max..mL. ~  most2$Age + most2$Sex+ most2$Race+ most2$BSA+ most2$SBP, data=short2_818 ))

short2_818$LAVminres <- stdres(lm(most2$LAV.min..mL. ~  most2$Age + most2$Sex+ most2$Race+ most2$BSA+ most2$SBP, data=short2_818 ))

short2_818$LASVres <- stdres(lm(most2$LASV..mL. ~  most2$Age + most2$Sex+ most2$Race+ most2$BSA+ most2$SBP, data=short2_818 ))

short2_818$LAEFres <- stdres(lm(most2$LAEF.... ~  most2$Age + most2$Sex+ most2$Race+ most2$BSA+ most2$SBP, data=short2_818 ))

short2_818$RAVmaxres <- stdres(lm(most2$RAV.max..mL. ~  most2$Age + most2$Sex+ most2$Race+ most2$BSA+ most2$SBP, data=short2_818 ))

short2_818$RAVminres <- stdres(lm(most2$RAV.min..mL.~  most2$Age + most2$Sex+ most2$Race+ most2$BSA+ most2$SBP, data=short2_818 ))

short2_818$RASVres <- stdres(lm( most2$RASV..mL.~  most2$Age + most2$Sex+ most2$Race+ most2$BSA+ most2$SBP, data=short2_818 ))

short2_818$RAEFres <- stdres(lm(most2$RAEF....~  most2$Age + most2$Sex+ most2$Race+ most2$BSA+ most2$SBP, data=short2_818 ))

#Grouping of traits 2564
short2564 <- data.frame( most2$AAo.max.area..mm2., most2$AAo.min.area..mm2., most2$DAo.max.area..mm2., most2$DAo.min.area..mm2., most2$Age, most2$Sex, most2$Race, most2$BSA, most2$SBP, most2$eid_18545)
short2_2564 <- delete.na(short2564)

#Logistic regression analysis to adjust CMR traits for age, genetic sex, White ancestry, BSA and SBP
short2_2564$AAomaxres <- stdres(lm(most2$AAo.max.area..mm2.~  most2$Age + most2$Sex+ most2$Race+ most2$BSA+ most2$SBP, data=short2_2564 ))

short2_2564$AAominres <- stdres(lm(most2$AAo.min.area..mm2.~  most2$Age + most2$Sex+ most2$Race+ most2$BSA+ most2$SBP, data=short2_2564 ))

short2_2564$DAomaxres <- stdres(lm(most2$DAo.max.area..mm2.~  most2$Age + most2$Sex+ most2$Race+ most2$BSA+ most2$SBP, data=short2_2564 ))

short2_2564$DAominres <- stdres(lm(most2$DAo.min.area..mm2.~  most2$Age + most2$Sex+ most2$Race+ most2$BSA+ most2$SBP, data=short2_2564 ))

#Grouping of traits 5797
short5797 <- data.frame(most2$AAo.distensibility..10.3.mmHg.1., most2$DAo.distensibility..10.3.mmHg.1.,   most2$Age, most2$Sex, most2$Race, most2$BSA, most2$SBP, most2$eid_18545)
short2_5797 <- delete.na(short5797)

#Logistic regression analysis to adjust CMR traits for age, genetic sex, White ancestry, BSA and SBP
short2_5797$AAodesres <- stdres(lm(most2$AAo.distensibility..10.3.mmHg.1.~  most2$Age + most2$Sex+ most2$Race+ most2$BSA+ most2$SBP, data=short2_5797 ))

short2_5797$DAodesres <- stdres(lm(most2$DAo.distensibility..10.3.mmHg.1.~  most2$Age + most2$Sex+ most2$Race+ most2$BSA+ most2$SBP, data=short2_5797 ))

#Grouping of traits 440               
short440 <- data.frame(most2$WT_Global..mm., most2$Age, most2$Sex, most2$Race, most2$BSA, most2$SBP, most2$eid_18545)
short2_440 <- delete.na(short440)

#Logistic regression analysis to adjust CMR traits for age, genetic sex, White ancestry, BSA and SBP
short2_440$WTglobalres <- stdres(lm(most2$WT_Global..mm. ~  most2$Age + most2$Sex+ most2$Race+ most2$BSA+ most2$SBP, data=short2_440 ))

#Grouping of traits 465 
short465 <- data.frame(most2$Ecc_Global...., most2$Err_Global...., most2$Age, most2$Sex, most2$Race, most2$BSA, most2$SBP, most2$eid_18545)
short2_465 <- delete.na(short465)

#Logistic regression analysis to adjust CMR traits for age, genetic sex, White ancestry, BSA and SBP
short2_465$Eccres <- stdres(lm(most2$Ecc_Global.... ~  most2$Age + most2$Sex+ most2$Race+ most2$BSA+ most2$SBP, data=short2_465 ))

short2_465$Errres <- stdres(lm(most2$Err_Global.... ~  most2$Age + most2$Sex+ most2$Race+ most2$BSA+ most2$SBP, data=short2_465 ))
                

#Grouping of traits 1549
short1549 <- data.frame(most2$Ell_Global...., most2$Age, most2$Sex, most2$Race, most2$BSA, most2$SBP, most2$eid_18545)
short2_1549 <- delete.na(short1549)

#Logistic regression analysis to adjust CMR traits for age, genetic sex, White ancestry, BSA and SBP
short2_1549$Ellres <- stdres(lm(most2$Ell_Global.... ~  most2$Age + most2$Sex+ most2$Race+ most2$BSA+ most2$SBP, data=short2_1549 ))

#Grouping of traits 555
short555 <- data.frame(most2$long_PDSR, most2$radial_PDSR,  most2$Age, most2$Sex, most2$Race, most2$BSA, most2$SBP, most2$eid_18545)
short2_555 <- delete.na(short555)

#Logistic regression analysis to adjust CMR traits for age, genetic sex, White ancestry, BSA and SBP
short2_555$lPDSRres <- stdres(lm(most2$long_PDSR ~  most2$Age + most2$Sex+ most2$Race+ most2$BSA+ most2$SBP, data=short2_555 ))

short2_555$rPDSRres <- stdres(lm(most2$radial_PDSR~  most2$Age + most2$Sex+ most2$Race+ most2$BSA+ most2$SBP, data=short2_555 ))


#Trabec CMR data, grouping of traits 
colnames(trabec)[1] <- "eid_18545"
trabec2 <- join(trabec, covar2, type="left", "eid_18545")

trashort<- data.frame(trabec2$eid_18545, trabec2$Mean_global_FD, trabec2$Mean_basal_FD, trabec2$Mean_apical_FD, trabec2$Max_basal_FD, trabec2$Max_apical_FD, trabec2$Age, trabec2$Sex, trabec2$Race, trabec2$BSA, trabec2$SBP, trabec2$eid_18545)
trabec3 <- delete.na(trashort)

#Logistic regression analysis to adjust CMR traits for age, genetic sex, White ancestry, BSA and SBP
trabec3$eid_18545res <- stdres(lm(trabec3$trabec2.eid_18545 ~  trabec3$trabec2.Age + trabec3$trabec2.Sex+ trabec3$trabec2.Race+ trabec3$trabec2.BSA+ trabec3$trabec2.SBP, data=trabec3 ))

trabec3$globalFDres <- stdres(lm(trabec3$trabec2.Mean_global_FD ~  trabec3$trabec2.Age + trabec3$trabec2.Sex+ trabec3$trabec2.Race + trabec3$trabec2.BSA + trabec3$trabec2.SBP, data=trabec3 ))

trabec3$basalFDres <- stdres(lm(trabec3$trabec2.Mean_basal_FD ~  trabec3$trabec2.Age + trabec3$trabec2.Sex+ trabec3$trabec2.Race+ trabec3$trabec2.BSA+ trabec3$trabec2.SBP, data=trabec3 ))

trabec3$apicalFDres <- stdres(lm(trabec3$trabec2.Mean_apical_FD ~  trabec3$trabec2.Age + trabec3$trabec2.Sex+ trabec3$trabec2.Race+ trabec3$trabec2.BSA+ trabec3$trabec2.SBP, data=trabec3 ))

trabec3$maxbasalres <- stdres(lm(trabec3$trabec2.Max_basal_FD ~  trabec3$trabec2.Age + trabec3$trabec2.Sex+ trabec3$trabec2.Race+ trabec3$trabec2.BSA+ trabec3$trabec2.SBP, data=trabec3 ))

trabec3$maxapicalres <- stdres(lm(trabec3$trabec2.Max_apical_FD ~  trabec3$trabec2.Age + trabec3$trabec2.Sex+ trabec3$trabec2.Race+ trabec3$trabec2.BSA+ trabec3$trabec2.SBP, data=trabec3 ))
```

#Statistical analysis of adjusted CMR traits in  participants with scoliosis
```{r}
library(plyr)
library(dplyr)

#Select participants with All-cause scoliosis from meta df
Sc <- meta[which(meta$AllScoliosis == "TRUE"),]

#Analysis of CMR traits in participants with scoliosis
short2_395$hasSc <- short2_395$most2.eid_18545 %in% Sc$eid_18545

t.test(short2_395$LVEFres ~ short2_395$hasSc)
t.test(short2_395$LVEDVres ~ short2_395$hasSc)

t.test(short2_395$LVESVres ~ short2_395$hasSc)
group_by(short2_395, hasSc) %>%
  dplyr::summarise(count = n(),
    mean_LVESV = mean(most2.LVESV..mL., na.rm = TRUE),
    SD_LVESV = sd(most2.LVESV..mL., na.rm = TRUE),
  )

t.test(short2_395$LVSVres ~ short2_395$hasSc)
group_by(short2_395, hasSc) %>%
  dplyr::summarise(count = n(),
    mean_LVSV = mean (most2.LVSV..mL., na.rm = TRUE),
    SD_LVSV = sd(most2.LVSV..mL., na.rm = TRUE),
  )

t.test(short2_395$LVCOres ~ short2_395$hasSc)
group_by(short2_395, hasSc) %>%
  dplyr::summarise(count = n(),
    mean_LVCO = mean (most2.LVCO..L.min., na.rm = TRUE),
    SD_LVCO = sd(most2.LVCO..L.min., na.rm = TRUE),
  )

t.test(short2_395$LVMres ~ short2_395$hasSc)
group_by(short2_395, hasSc) %>%
  dplyr::summarise(count = n(),
    mean_LVM = mean (most2.LVM..g. , na.rm = TRUE),
    SD_LVM = sd(most2.LVM..g. , na.rm = TRUE),
  )

t.test(short2_395$RVEDVres ~ short2_395$hasSc)
group_by(short2_395, hasSc) %>%
  dplyr::summarise(count = n(),
    mean_RVEDV = mean (most2.RVEDV..mL. , na.rm = TRUE),
    SD_RVEDV = sd(most2.RVEDV..mL. , na.rm = TRUE),
  )

t.test(short2_395$RVESVres ~ short2_395$hasSc)
group_by(short2_395, hasSc) %>%
  dplyr::summarise(count = n(),
    mean_RVESV = mean (most2.RVESV..mL. , na.rm = TRUE),
    SD_RVESV = sd(most2.RVESV..mL. , na.rm = TRUE),
  )

t.test(short2_395$RVSVres ~ short2_395$hasSc)
group_by(short2_395, hasSc) %>%
  dplyr::summarise(count = n(),
    mean_RVSV = mean (most2.RVSV..mL. , na.rm = TRUE),
    SD_RVSV = sd(most2.RVSV..mL. , na.rm = TRUE),
  ) 

t.test(short2_395$RVEFres ~ short2_395$hasSc)
group_by(short2_395, hasSc) %>%
  dplyr::summarise(count = n(),
    mean_RVEF = mean (most2.RVEF.... , na.rm = TRUE),
    SD_RVEF = sd(most2.RVEF.... , na.rm = TRUE),
  )


#440
short2_440$hasSc <- short2_440$most2.eid_18545 %in% Sc$eid_18545

t.test(short2_440$WTglobalres ~ short2_440$hasSc)
group_by(short2_440, hasSc) %>%
  dplyr::summarise(count = n(),
    mean_WTglobal = mean (most2.WT_Global..mm. , na.rm = TRUE),
    SD_WTglobal = sd(most2.WT_Global..mm. , na.rm = TRUE),
  )

wt3$hasMD <- wt3$eid_18545 %in% MD$eid_18545

#818 
short2_818$hasSc <- short2_818$most2.eid_18545 %in% Sc$eid_18545
t.test(short2_818$LAVmaxres ~ short2_818$hasSc)
group_by(short2_818, hasSc) %>%
  dplyr::summarise(count = n(),
    mean_LAVmax = mean (most2.LAV.max..mL. , na.rm = TRUE),
    SD_LAVmax= sd(most2.LAV.max..mL. , na.rm = TRUE),
  )

t.test(short2_818$LAVminres ~ short2_818$hasSc)
group_by(short2_818, hasSc) %>%
  dplyr::summarise(count = n(),
    mean_LAVmin = mean (most2.LAV.min..mL. , na.rm = TRUE),
    SD_LAVmin= sd(most2.LAV.min..mL. , na.rm = TRUE),
  )

t.test(short2_818$LASVres ~ short2_818$hasSc)
group_by(short2_818, hasSc) %>%
  dplyr::summarise(count = n(),
    mean_LASVmin = mean (most2.LASV..mL. , na.rm = TRUE),
    SD_LASVmin= sd(most2.LASV..mL. , na.rm = TRUE),
  )

t.test(short2_818$LAEFres ~ short2_818$hasSc)
group_by(short2_818, hasSc) %>%
  dplyr::summarise(count = n(),
    mean_LAEF = mean (most2.LAEF.... , na.rm = TRUE),
    SD_LAEF= sd(most2.LAEF.... , na.rm = TRUE),
)

t.test(short2_818$RAVmaxres ~ short2_818$hasSc)
group_by(short2_818, hasSc) %>%
  dplyr::summarise(count = n(),
    mean_RAVmax = mean (most2.RAV.max..mL. , na.rm = TRUE),
    SD_RAVmax= sd(most2.RAV.max..mL. , na.rm = TRUE),
  )

t.test(short2_818$RAVminres ~ short2_818$hasSc)
group_by(short2_818, hasSc) %>%
  dplyr::summarise(count = n(),
    mean_RAVmin = mean (most2.RAV.min..mL. , na.rm = TRUE),
    SD_RAVmin= sd(most2.RAV.min..mL. , na.rm = TRUE),
  )

t.test(short2_818$RASVres ~ short2_818$hasSc)
group_by(short2_818, hasSc) %>%
  dplyr::summarise(count = n(),
    mean_RASV = mean (most2.RASV..mL. , na.rm = TRUE),
    SD_RASV= sd(most2.RASV..mL. , na.rm = TRUE),
  )

t.test(short2_818$RAEFres ~ short2_818$hasSc)
group_by(short2_818, hasSc) %>%
  dplyr::summarise(count = n(),
    mean_RAEF = mean (most2.RAEF.... , na.rm = TRUE),
    SD_RAEF= sd(most2.RAEF.... , na.rm = TRUE),
  )


#2564
short2_2564$hasSc <- short2_2564$most2.eid_18545 %in% Sc$eid_18545

t.test(short2_2564$AAomaxres ~ short2_2564$hasSc)
group_by(short2_2564, hasSc) %>%
  dplyr::summarise(count = n(),
    mean_AAoMax = mean (most2.AAo.max.area..mm2. , na.rm = TRUE),
    SD_AAoMax= sd(most2.AAo.max.area..mm2. , na.rm = TRUE),
  )


t.test(short2_2564$AAominres ~ short2_2564$hasSc)
group_by(short2_2564, hasSc) %>%
  dplyr::summarise(count = n(),
    mean_AAoMin = mean (most2.AAo.min.area..mm2. , na.rm = TRUE),
    SD_AAoMin= sd(most2.AAo.min.area..mm2. , na.rm = TRUE),
  )

t.test(short2_2564$DAomaxres ~ short2_2564$hasSc)
group_by(short2_2564, hasSc) %>%
  dplyr::summarise(count = n(),
    mean_DAoMax = mean (most2.DAo.max.area..mm2. , na.rm = TRUE),
    SD_DAoMax= sd(most2.DAo.max.area..mm2. , na.rm = TRUE),
  )

t.test(short2_2564$DAominres ~ short2_2564$hasSc)
group_by(short2_2564, hasSc) %>%
  dplyr::summarise(count = n(),
    mean_DAoMin = mean (most2.DAo.min.area..mm2. , na.rm = TRUE),
    SD_DAoMin= sd(most2.DAo.min.area..mm2. , na.rm = TRUE),
  )


#5797 
short2_5797$hasSc <- short2_5797$most2.eid_18545 %in% Sc$eid_18545

t.test(short2_5797$AAodesres ~ short2_5797$hasSc)
group_by(short2_5797, hasSc) %>%
  dplyr::summarise(count = n(),
    mean_AAo = mean (most2.AAo.distensibility..10.3.mmHg.1. , na.rm = TRUE),
    SD_AAo= sd(most2.AAo.distensibility..10.3.mmHg.1. , na.rm = TRUE),
  )

t.test(short2_5797$DAodesres ~ short2_5797$hasSc)
group_by(short2_5797, hasSc) %>%
  dplyr::summarise(count = n(),
    mean_DAo = mean (most2.DAo.distensibility..10.3.mmHg.1. , na.rm = TRUE),
    SD_DAo= sd(most2.DAo.distensibility..10.3.mmHg.1. , na.rm = TRUE),)

#465 

short2_465$hasSc <- short2_465$most2.eid_18545 %in% Sc$eid_18545
t.test(short2_465$Eccres ~ short2_465$hasSc)
group_by(short2_465, hasSc) %>%
  dplyr::summarise(count = n(),
    mean_Ecc = mean (most2.Ecc_Global.... , na.rm = TRUE),
    SD_Ecc= sd(most2.Ecc_Global.... , na.rm = TRUE),
  )

t.test(short2_465$Errres ~ short2_465$hasSc)
group_by(short2_465, hasSc) %>%
  dplyr::summarise(count = n(),
    mean_Err = mean (most2.Err_Global.... , na.rm = TRUE),
    SD_Err= sd(most2.Err_Global.... , na.rm = TRUE),
  )

#1549
short2_1549$hasSc <- short2_1549$most2.eid_18545 %in% Sc$eid_18545

t.test(short2_1549$Ellres ~ short2_1549$hasSc)
group_by(short2_1549, hasSc) %>%
  dplyr::summarise(count = n(),
    mean_Ell = mean (most2.Ell_Global.... , na.rm = TRUE),
    SD_Ell= sd(most2.Ell_Global.... , na.rm = TRUE),
  )


#555
short2_555$hasSc <- short2_555$most2.eid_18545 %in% Sc$eid_18545

t.test(short2_555$lPDSRres ~ short2_555$hasSc)
group_by(short2_555, hasSc) %>%
  dplyr::summarise(count = n(),
    mean_lPDSR = mean (most2.long_PDSR , na.rm = TRUE),
    SD_lPDSR= sd(most2.long_PDSR , na.rm = TRUE),
  )

t.test(short2_555$rPDSRres ~ short2_555$hasSc)
group_by(short2_555, hasSc) %>%
  dplyr::summarise(count = n(),
    mean_rPDSR = mean (most2.radial_PDSR , na.rm = TRUE),
    SD_rPDSR= sd(most2.radial_PDSR , na.rm = TRUE),
  )


#Trabec
trabec3$hasSc <- trabec3$trabec2.eid_18545 %in% Sc$eid_18545

t.test(trabec3$globalFDres ~ trabec3$hasSc)
group_by(trabec3, hasSc) %>%
  dplyr::summarise(count = n(),
    mean_globalFD = mean (trabec2.Mean_global_FD , na.rm = TRUE),
    SD_globalFD= sd(trabec2.Mean_global_FD , na.rm = TRUE),
  )

t.test(trabec3$basalFDres ~ trabec3$hasSc)
group_by(trabec3, hasSc) %>%
  dplyr::summarise(count = n(),
    mean_basalFD = mean (trabec2.Mean_basal_FD , na.rm = TRUE),
    SD_basalFD= sd(trabec2.Mean_basal_FD , na.rm = TRUE),
  )


t.test(trabec3$apicalFDres ~ trabec3$hasSc)
group_by(trabec3, hasSc) %>%
  dplyr::summarise(count = n(),
    mean_apicalFD = mean (trabec2.Mean_apical_FD , na.rm = TRUE),
    SD_apicalFD= sd(trabec2.Mean_apical_FD , na.rm = TRUE),
  )


t.test(trabec3$maxbasalres ~ trabec3$hasSc)
group_by(trabec3, hasSc) %>%
  dplyr::summarise(count = n(),
    mean_maxbasal = mean (trabec2.Max_basal_FD , na.rm = TRUE),
    SD_maxbasal= sd(trabec2.Mean_apical_FD , na.rm = TRUE),
  )

t.test(trabec3$maxapicalres ~ trabec3$hasSc)
group_by(trabec3, hasSc) %>%
  dplyr::summarise(count = n(),
    mean_maxapical = mean (trabec2.Max_apical_FD , na.rm = TRUE),
    SD_maxapical= sd(trabec2.Max_apical_FD , na.rm = TRUE),
  )

```
